name: Build Image
on:
  push:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
        - name: Checkout Repository
          uses: actions/checkout@v4

        - name: Login into Github Docker Registery
          run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin

        - name: Install Shopware-CLI
          uses: FriendsOfShopware/shopware-cli-action@v1

        - name: Make image name small
          id: image
          run: |
            export "name=ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest"
            echo "image=${name,,}" >> ${GITHUB_OUTPUT}

        - name: Build image
          run: shopware-cli project docker build ${{ steps.image.outputs.image }}

        - name: Push
          run: docker push ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
